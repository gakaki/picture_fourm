---
name: 图像生成服务
status: open
created: 2025-09-05T05:07:42Z
updated: 2025-09-05T05:23:33Z
github: https://github.com/gakaki/picture_fourm/issues/8
depends_on: [001, 002]
parallel: false
conflicts_with: []
---

# Task: 图像生成服务

## 描述
集成Google Gemini 2.5 Flash Image Preview API，实现图像生成队列管理、异步生成、结果获取和图像上传到阿里云OSS。包括Credits扣费逻辑、生成历史记录、错误重试机制。

## 验收标准
- [ ] Gemini API集成完成
- [ ] 生成队列管理实现（Redis队列）
- [ ] 异步生成任务处理器完成
- [ ] OSS图像上传功能实现
- [ ] Credits扣费逻辑完成
- [ ] 生成历史记录保存

## 技术细节
- API端点：POST /api/v1/generate、GET /api/v1/generate/:id
- 使用Redis实现生成队列（LIST结构）
- 图像格式转换为WebP，压缩后上传OSS
- 生成超时设置：10秒（Gemini）
- 失败重试：最多3次，间隔递增
- API Key: AIzaSyA345yfONVRg0nbPONBoIIP-VbWf9YgaMY

## 依赖
- [ ] 任务001完成（项目基础搭建）
- [ ] 任务002完成（用户认证，需要验证Credits）
- [ ] 阿里云OSS配置完成

## 工作量估算
- 规模：L
- 工时：20小时
- 并行：false（依赖任务001和002）

## 完成标准
- [ ] 代码实现完成
- [ ] 集成测试通过
- [ ] 生成功能端到端测试通过
- [ ] 性能测试（并发10个生成任务）
- [ ] 错误处理和日志记录完善
