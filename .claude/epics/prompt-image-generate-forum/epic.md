---
name: prompt-image-generate-forum
status: backlog
created: 2025-09-05T05:05:29Z
progress: 0%
updated: 2025-09-05T05:23:33Z
prd: .claude/prds/prompt-image-generate-forum.md
github: https://github.com/gakaki/picture_fourm/issues/1
---

# Epic: prompt-image-generate-forum

## 概览

构建AI图像创作垂直论坛的技术实施方案，采用前后端分离架构，集成Google Gemini 2.5 Flash Image Preview API实现图像生成，使用MongoDB存储数据，Redis处理缓存和会话，阿里云OSS存储图像。核心重点是快速迭代MVP版本，优先实现图像生成、论坛基础功能和Credits系统。

## 架构决策

### 核心技术选型
- **后端框架**：Go + Gin（高性能、易部署、并发处理能力强）
- **数据库**：MongoDB（灵活的文档结构，适合社区内容）+ Redis（缓存、会话、队列）
- **前端框架**：React 19 + Vite + TailwindCSS v4（现代化技术栈，开发效率高）
- **图像生成**：Google Gemini API（主力） + 预留扩展接口
- **存储方案**：阿里云OSS + CDN（成本可控，访问速度快）
- **实时通信**：WebSocket（用于协作室功能）

### 设计原则
1. **MVP优先**：先实现核心功能，后续迭代增强
2. **模块化设计**：便于功能扩展和维护
3. **统一API规范**：RESTful + 统一响应格式
4. **安全第一**：JWT认证、API限流、内容审核
5. **性能优化**：多级缓存、异步处理、CDN加速

## 技术方案

### 前端组件架构
- **页面路由**：
  - 首页（作品展示、分类浏览）
  - 创作中心（图像生成、提示词编辑）
  - 社区论坛（帖子列表、详情、评论）
  - 个人中心（作品集、Credits、设置）
  - 管理后台（用户管理、内容审核）

- **核心组件**：
  - ImageGenerator（生成界面）
  - PromptEditor（提示词编辑器）
  - PostCard（帖子卡片）
  - CommentTree（评论树）
  - CreditBalance（积分显示）

- **状态管理**：Valtio（简单高效）
- **网络请求**：Axios + TanStack Query

### 后端服务设计

#### API模块划分
1. **用户服务** (`/api/v1/users`)
   - 注册登录、个人信息、Credits管理

2. **生成服务** (`/api/v1/generate`)
   - 图像生成、队列管理、结果获取

3. **论坛服务** (`/api/v1/forum`)
   - 帖子CRUD、评论、点赞收藏

4. **提示词服务** (`/api/v1/prompts`)
   - 模板管理、版本控制、协作

5. **管理服务** (`/api/v1/admin`)
   - 用户管理、内容审核、数据统计

#### 数据模型设计
- **核心集合**：users、posts、comments、generations、templates、transactions
- **索引策略**：用户ID、时间戳、分类标签、热度评分
- **缓存策略**：热门内容、用户会话、生成队列

### 基础设施
- **部署方案**：Docker容器化，支持快速扩展
- **监控告警**：API响应时间、生成队列长度、错误率
- **日志管理**：结构化日志，便于问题排查

## 实施策略

### 开发阶段
1. **Phase 1 - 基础框架**（第1-2周）
   - 项目初始化、数据库设计、API框架搭建

2. **Phase 2 - 核心功能**（第3-6周）
   - 用户系统、图像生成、基础论坛功能

3. **Phase 3 - 社区功能**（第7-9周）
   - 评论互动、提示词模板、Credits系统

4. **Phase 4 - 优化完善**（第10-12周）
   - 管理后台、性能优化、部署上线

### 风险缓解
- **API限流**：防止恶意调用导致成本失控
- **内容审核**：先发后审 + 用户举报机制
- **渐进式发布**：内测→公测→正式上线

### 测试方案
- 单元测试：核心业务逻辑覆盖率>80%
- API测试：Postman自动化测试
- 压力测试：模拟1000并发用户
- 用户测试：招募50名种子用户内测

## 任务分解预览

精简为10个核心任务，覆盖MVP全部功能：

- [ ] **T1: 项目基础搭建** - 初始化前后端项目、配置开发环境、设计数据库模式
- [ ] **T2: 用户认证系统** - 实现注册登录、JWT认证、Credits余额管理
- [ ] **T3: 图像生成服务** - 集成Gemini API、实现生成队列、图像上传OSS
- [ ] **T4: 论坛核心功能** - 帖子发布展示、分类系统、热度排序算法
- [ ] **T5: 社区互动系统** - 评论功能、点赞收藏、用户关注
- [ ] **T6: 提示词模板库** - 官方模板管理、用户模板分享、一键复用
- [ ] **T7: 前端界面开发** - 响应式布局、组件开发、路由配置
- [ ] **T8: 管理后台基础** - 用户管理、Credits充值、内容审核队列
- [ ] **T9: 支付与会员系统** - Premium会员、Credits购买、交易记录
- [ ] **T10: 部署与优化** - Docker部署、性能优化、监控配置

## 依赖关系

### 外部服务依赖
- Google Gemini API - 已提供密钥
- 阿里云OSS - 需开通配置
- MongoDB Atlas / 自建MongoDB
- Redis服务
- 短信服务（可选，后期添加）

### 内部依赖
- 环境配置文件（.env）
- API文档（OpenAPI规范）
- 数据库迁移脚本
- Docker配置文件

### 前置条件
- 域名备案（如使用国内服务器）
- SSL证书
- CDN配置
- 支付接口申请（后期）

## 技术成功标准

### 性能基准
- API平均响应时间 < 200ms
- 图像生成平均时间 < 10s（Gemini）
- 页面首屏加载 < 2s
- 并发支持 > 1000用户

### 质量门槛
- 代码测试覆盖率 > 70%
- 无Critical级别安全漏洞
- 前端Lighthouse评分 > 80
- 零容忍P0级Bug

### 验收标准
- 完成所有核心功能开发
- 通过50用户内测验证
- 7天稳定性测试无重大故障
- 文档完整（API文档、部署文档、运维手册）

## 预估工作量

### 整体时间线
- **总工期**：12周（3个月）
- **MVP版本**：8周完成核心功能
- **优化迭代**：4周完善体验

### 资源需求
- **开发团队**：
  - 2名前端开发（React专家）
  - 2名后端开发（Go专家）
  - 1名全栈开发（负责集成）
  
### 关键路径
1. 用户系统 → 图像生成 → 论坛功能（前6周）
2. 社区功能 → 管理后台（第7-9周）
3. 支付系统 → 部署优化（第10-12周）

## 优化与简化建议

### 技术简化
1. **使用成熟组件库**：Shadcn/ui减少UI开发时间
2. **复用开源方案**：评论系统可基于开源项目改造
3. **渐进式功能**：协作室等复杂功能可后期添加
4. **简化支付**：初期仅支持支付宝/微信，避免复杂集成

### 架构优化
1. **单体优先**：MVP阶段不必过度微服务化
2. **缓存优先**：充分利用Redis减少数据库压力
3. **静态化**：热门内容定期生成静态页面
4. **异步处理**：图像生成采用消息队列异步处理

### 成本控制
1. **按需扩展**：初期使用单机，根据用户量扩展
2. **API配额**：合理设置每用户配额，避免滥用
3. **CDN优化**：仅对图像启用CDN，减少流量费用
4. **开源优先**：优先使用开源方案降低license成本

## 已创建任务

- [ ] #5 - 项目基础搭建 (parallel: true)
- [ ] #7 - 用户认证系统 (parallel: false, depends_on: [5])
- [ ] #8 - 图像生成服务 (parallel: false, depends_on: [5, 7])
- [ ] #2 - 论坛核心功能 (parallel: true, depends_on: [7])
- [ ] #3 - 社区互动系统 (parallel: true, depends_on: [7, 2])
- [ ] #4 - 提示词模板库 (parallel: true, depends_on: [7])
- [ ] #6 - 前端界面开发 (parallel: true, depends_on: [5])
- [ ] #9 - 管理后台基础 (parallel: true, depends_on: [7, 2])
- [ ] #10 - 支付与会员系统 (parallel: false, depends_on: [7, 6])
- [ ] #11 - 部署与优化 (parallel: false, depends_on: all)

**任务统计**：
- 任务总数：10个
- 可并行任务：6个
- 顺序执行任务：4个
- 预估总工时：154小时

**任务规模分布**：
- XL级（24小时）：1个（前端界面开发）
- L级（16-20小时）：5个
- M级（12-14小时）：4个

---

*本Epic基于PRD需求制定，聚焦MVP快速落地，后续可根据用户反馈持续迭代优化。*