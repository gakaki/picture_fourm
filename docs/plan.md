# Nano Banana AI图片生成系统计划

## 项目概述
基于nano banana免费API和OpenRouter的免费API (google/gemini-2.5-flash-image-preview:free) 构建一个完整的AI图片生成管理系统。用户可以保存每次生成的图片，进行提示词搜索管理，支持批量生成、队列系统和图生图功能。

**API密钥**: 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

## 核心功能模块

### 1. 用户界面层 (Frontend)
- **技术栈**: React 19 + Vite + Tailwind CSS v4 + shadcn/ui
- **构建工具**: rolldown-vite + pnpm
- **状态管理**: Valtio
- **网络请求**: Tanstack Query + Axios
- **响应式设计**: 支持PC和移动端

#### 主要页面:
- 图片生成页面 (支持文本生成图片和图生图)
- 提示词管理页面 (保存、搜索、分类管理)
- 批量生成页面 (队列管理、进度跟踪)
- 生成历史页面 (搜索、查看历史生成记录)
- 图片库页面 (查看、下载、管理生成的图片)

### 2. 后端服务层 (Backend)
- **技术栈**: Go 1.25 + Gin + GORM + Resty
- **数据库**: MongoDB (主数据存储)
- **缓存**: Redis (队列系统、会话缓存)
- **文件存储**: 本地文件系统
- **热重载**: Air

#### 主要服务:
- 图片生成服务 (调用OpenRouter API)
- 提示词管理服务
- 队列管理服务
- 用户会话服务
- 文件管理服务

### 3. 数据存储层
- **MongoDB集合**:
  - `prompts` - 提示词管理
  - `generations` - 生成记录
  - `batch_jobs` - 批量任务
  - `images` - 图片元数据
- **Redis**:
  - 生成队列
  - 任务状态缓存
  - 会话数据

### 4. 队列系统
- 支持单个提示词多次生成
- 支持批量不同提示词生成
- 任务优先级管理
- 进度实时更新
- 失败重试机制

## 开发阶段

### 第一阶段: 基础架构搭建
1. 项目结构初始化
2. 数据库设计和连接配置
3. 基本的API框架搭建
4. 前端基础组件开发

### 第二阶段: 核心功能实现
1. OpenRouter API集成
2. 基本图片生成功能
3. 提示词CRUD操作
4. 图片保存和管理

### 第三阶段: 高级功能
1. 批量生成和队列系统
2. 图生图功能
3. 搜索和过滤功能
4. 用户界面优化

### 第四阶段: 完善和测试
1. 错误处理和重试机制
2. 性能优化
3. 全面测试
4. 部署准备

## 技术规范

### API设计原则
- RESTful API设计
- 统一错误处理
- 请求响应格式标准化
- CORS全开放配置

### 数据库设计原则
- 软删除机制 (deleted, deleted_at, deleted_reason)
- 使用 REPLACE INTO 替代 INSERT INTO
- 数据关系设计合理

### 前端开发规范
- 使用 shadcn/ui 组件库
- 强制使用 Tailwind CSS v4
- 响应式设计
- 使用 Biome 进行代码格式化和检查

### 后端开发规范
- 结构化错误处理
- 环境变量配置管理
- 接口超时和重试配置
- 日志记录规范

## 部署配置
- 使用 .env 文件管理环境变量
- MongoDB 和 Redis 连接配置
- 文件存储路径配置
- API密钥安全管理