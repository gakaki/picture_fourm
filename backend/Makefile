# Nano Banana Qwen - Go Backend Makefile

.PHONY: help build run dev test clean deps lint

# é»˜è®¤ç›®æ ‡
all: deps build

# å¸®åŠ©ä¿¡æ¯
help:
	@echo "å¯ç”¨çš„å‘½ä»¤:"
	@echo "  make deps     - å®‰è£…ä¾èµ–"
	@echo "  make build    - æ„å»ºåº”ç”¨"
	@echo "  make run      - è¿è¡Œåº”ç”¨"
	@echo "  make dev      - å¼€å‘æ¨¡å¼è¿è¡Œ"
	@echo "  make test     - è¿è¡Œæµ‹è¯•"
	@echo "  make clean    - æ¸…ç†æ„å»ºæ–‡ä»¶"
	@echo "  make lint     - ä»£ç æ£€æŸ¥"

# å®‰è£…ä¾èµ–
deps:
	@echo "ğŸ“¦ å®‰è£…Goä¾èµ–..."
	go mod tidy
	go mod download

# æ„å»ºåº”ç”¨
build:
	@echo "ğŸ—ï¸ æ„å»ºåº”ç”¨..."
	go build -o bin/nano-banana-qwen cmd/main.go

# è¿è¡Œåº”ç”¨
run: build
	@echo "ğŸš€ è¿è¡Œåº”ç”¨..."
	./bin/nano-banana-qwen

# å¼€å‘æ¨¡å¼è¿è¡Œ
dev:
	@echo "ğŸ”§ å¼€å‘æ¨¡å¼è¿è¡Œ..."
	@if command -v air >/dev/null 2>&1; then \
		air; \
	else \
		echo "âš ï¸ Air æœªå®‰è£…ï¼Œæ­£åœ¨å®‰è£…..."; \
		go install github.com/cosmtrek/air@latest; \
		air; \
	fi

# è¿è¡Œæµ‹è¯•
test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	go test -v ./...

# æ¸…ç†æ„å»ºæ–‡ä»¶
clean:
	@echo "ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶..."
	rm -rf bin/
	go clean

# ä»£ç æ£€æŸ¥
lint:
	@echo "ğŸ” ä»£ç æ£€æŸ¥..."
	@if command -v golangci-lint >/dev/null 2>&1; then \
		golangci-lint run; \
	else \
		echo "âš ï¸ golangci-lint æœªå®‰è£…ï¼Œæ­£åœ¨å®‰è£…..."; \
		go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest; \
		golangci-lint run; \
	fi

# åˆå§‹åŒ–æ•°æ®ç›®å½•
init-dirs:
	@echo "ğŸ“ åˆ›å»ºæ•°æ®ç›®å½•..."
	mkdir -p data/{uploads,images/{generated,thumbnails},temp,logs}
	@echo "âœ… ç›®å½•åˆ›å»ºå®Œæˆ"

# æ ¼å¼åŒ–ä»£ç 
fmt:
	@echo "ğŸ’… æ ¼å¼åŒ–ä»£ç ..."
	go fmt ./...

# æ£€æŸ¥Goç‰ˆæœ¬
check-go:
	@echo "ğŸ” æ£€æŸ¥Goç‰ˆæœ¬..."
	@go version | grep -q "go1.2[5-9]" || (echo "âŒ éœ€è¦Go 1.25æˆ–æ›´é«˜ç‰ˆæœ¬" && exit 1)
	@echo "âœ… Goç‰ˆæœ¬æ£€æŸ¥é€šè¿‡"